package com.jctx.chat.service;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;

import com.jctx.chat.Utils.ChatException;
import com.jctx.chat.dao.ChatGroupDao;
import com.jctx.chat.dao.ChatGroupMemDao;
import com.jctx.chat.dao.UserManagerDao;
import com.jctx.chat.module.ChatUserBean;

@Service
public class ChatGroupService {

	@Resource UserManagerDao userManagerDao;
	@Resource ChatGroupDao chatGroupDao;
	@Resource ChatGroupMemDao chatGroupMemDao;
	
	public boolean checkAuthorize(ChatUserBean bean) {
		
		ChatUserBean beanInDb = userManagerDao.getChatUserInfo(bean.getUid());
		
		if (beanInDb.getGroupNumCreated() >= beanInDb.getGroupRight()){
			return false;
		}
		
		return true;
	}

	public void createChatGroup(ChatUserBean bean, String groupName) throws ChatException { 
		
		int grpId = chatGroupDao.createChatGroup(bean, groupName);
		
		chatGroupMemDao.addMember(grpId, bean);
	}

}
