package com.jctx.chat.module;

import java.util.ArrayList;

import javax.annotation.Resource;

import org.springframework.stereotype.Component;

import com.jctx.chat.dao.ChatMsgDao;
 

@Component
public class ChatMessageCacheForDb extends ArrayList<MessageBean> {

	private static final long serialVersionUID = -6408973966469451526L;

	@Resource ChatMsgDao chatMsgDao;
	
	public ChatMessageCacheForDb(){
		super(10000);
	}

	public ChatMessageCacheForDb(ChatMessageCacheForDb chatMessageCacheForDb) {
		super(chatMessageCacheForDb);
	}

	public boolean needFlush() { 
		return false;
	}

	public void flushMessage() {
		ChatMessageCacheForDb tmp = new ChatMessageCacheForDb(this);
		this.clear();
		
		FlushTask task = new FlushTask(tmp);
		task.start();
	}
	
	class FlushTask extends Thread{
		
		ChatMessageCacheForDb messageQueue;
		
		public FlushTask(ChatMessageCacheForDb queue){
			this.messageQueue = queue;
		}
		
		@Override
		public void run(){
			
			chatMsgDao.saveMessageList(this.messageQueue);
		}
	};
	
	
}
