<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jctx.chat.usermanager" >

	<resultMap id="BaseResultMap" type="com.jctx.chat.module.ChatUserBean" >
		<id column="uid" property="uid" jdbcType="INTEGER" />
		<result column="level" property="level" jdbcType="TINYINT" /> 
		<result column="groupRight" property="groupRight" jdbcType="INTEGER" />
		<result column="groupNumCreated" property="groupNumCreated" jdbcType="INTEGER" />
		<result column="userName" property="userName" jdbcType="VARCHAR" />  
		<result column="createTime" property="createTime" jdbcType="TIMESTAMP" /> 
		<result column="updateTime" property="updateTime" jdbcType="TIMESTAMP" /> 
	</resultMap>
	
	<sql id="Base_Column_List" >
	 	uid, level, groupRight, groupNumCreated, userName, createTime, updateTime
	</sql>
	
	<select id="getUser" parameterType="java.lang.Integer"  resultMap="BaseResultMap">
	
		SELECT <include refid="Base_Column_List" /> 
	 	
	 	FROM jctx_chat_userbase
	 	
	 	<where>
	 		uid = #{value}
	 	</where>
	 	
	</select>
	
	<insert id="createUser" parameterType="com.jctx.chat.module.ChatUserBean">
		INSERT INTO jctx_chat_userbase
		
			(uid, level, groupRight, groupNumCreated, userName, createTime)
			
		VALUES
			
			(#{uid}, #{level}, #{groupRight}, 0, #{userName}, now())
	</insert>
	
	<update id="updateUser"  parameterType="map">
		UPDATE jctx_chat_userbase
		
		<set>
			<if test="level != null">
				level = #{level}, 
			</if>
			
			<if test="groupRight != null">
				groupRight = #{groupRight}, 
			</if>
			
			<if test="userName != null">
				userName = #{userName}, 
			</if> 
			
			<if test="grpNum != null">
				groupNumCreated = groupNumCreated + #{grpNum}, 
			</if>  
			
			updateTime = now()
		</set>
			
		<where>
			uid = #{uid}
		</where>
		
	</update>
	 
	 
	
	<select id="listUsers" resultMap="BaseResultMap" parameterType="java.lang.Integer" > 
		SELECT 
		
			<include refid="Base_Column_List" />
			
		FROM  jctx_chat_userbase
		
		<where>
			uid < #{value}
		</where>
		
		ORDER BY uid DESC
		
		LIMIT 20
	</select>
	
	
</mapper>